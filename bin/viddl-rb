#!/usr/bin/env ruby
$LOAD_PATH << File.join(File.dirname(__FILE__), '..', 'helper')

require "rubygems"
require "nokogiri"
require "mechanize"
require "cgi"
require "open-uri"
require "open3"

require "driver.rb"
require "downloader.rb"
require "download-helper.rb"
require "application-helper.rb"
require "plugin-helper.rb"
require "audio-helper.rb"

begin
  params = ApplicationHelper.parse_app_parameters

  puts "Loading Plugins"
  ApplicationHelper.load_plugins
  "Plugins loaded: #{PluginBase.registered_plugins.inspect}"

  puts "Will try to extract audio: #{params[:extract_audio] == true}."
  puts "Analyzing URL: #{params[:url]}"

  app = Driver.new(params)   
  app.start                  # starts the download process

rescue StandardError => e
  puts "#{e.message}"
end
